# ShardingSphere åœ¨ DI-Assistant ä¸­çš„ä½¿ç”¨åœºæ™¯

## ğŸ“Œ å¿«é€Ÿæ¦‚è§ˆ

| é¡¹ç›® | å€¼ |
|------|-----|
| ç‰ˆæœ¬ | 4.1.1 |
| ä¾èµ–ä½ç½® | `pom.xml` Line 175-179 |
| ç‰ˆæœ¬å®šä¹‰ | `pom.xml` Line 33 |
| ä¸»è¦ç”¨é€” | æ•°æ®åº“åˆ†ç‰‡ã€è¯»å†™åˆ†ç¦»ã€åˆ†å¸ƒå¼äº‹åŠ¡ |
| æ ¸å¿ƒåŠŸèƒ½ | æ•°æ®åº“ä¸­é—´å±‚ã€SQL è§£æã€æ‰§è¡Œè·¯ç”± |

---

## ğŸŸ  ä¾èµ–ä¿¡æ¯

```xml
<!-- pom.xml -->
<properties>
  <sharding-jdbc-core.version>4.1.1</sharding-jdbc-core.version>
</properties>

<dependency>
  <groupId>org.apache.shardingsphere</groupId>
  <artifactId>sharding-jdbc-core</artifactId>
  <version>${sharding-jdbc-core.version}</version>
</dependency>
```

---

## ğŸ’¡ æ ¸å¿ƒæ¦‚å¿µ

### ShardingSphere å·¥ä½œæµ

```
SQL è¯·æ±‚
   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQL è§£æ (SQL Parser)              â”‚
â”‚  - è¯†åˆ« SQL ç±»å‹                    â”‚
â”‚  - æå–åˆ†ç‰‡é”® (Sharding Key)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è·¯ç”±åˆ†æ (Route)                   â”‚
â”‚  - æ ¹æ®åˆ†ç‰‡è§„åˆ™å†³å®šç›®æ ‡æ•°æ®åº“/è¡¨    â”‚
â”‚  - ç”Ÿæˆè·¯ç”±ç»“æœ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  SQL æ”¹å†™ (Rewrite)                 â”‚
â”‚  - è¡¨åæ”¹å†™                         â”‚
â”‚  - é€»è¾‘è¡¨ â†’ ç‰©ç†è¡¨                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  æ‰§è¡Œå±‚ (Executor)                  â”‚
â”‚  - å¹¶å‘æ‰§è¡Œå¤šæ¡ SQL                 â”‚
â”‚  - è¿æ¥ç®¡ç†                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ç»“æœèšåˆ (Merge)                   â”‚
â”‚  - åˆå¹¶å¤šæ•°æ®æºç»“æœé›†               â”‚
â”‚  - æ’åº/åˆ†é¡µ/åˆ†ç»„                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“
           ç»“æœè¿”å›
```

---

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: Chat æ¶ˆæ¯è¡¨åˆ†ç‰‡

**è¡¨ç»“æ„**:
```sql
CREATE TABLE chat_message_tab (
    id BIGINT PRIMARY KEY,
    session_id BIGINT NOT NULL,
    from_user_name VARCHAR(64),
    message_type VARCHAR(32),
    chat_content MEDIUMTEXT,
    create_time BIGINT NOT NULL,
    delete_time BIGINT DEFAULT 0,
    MODEL VARCHAR(32)
);
```

**åˆ†ç‰‡ç­–ç•¥**:

```
åˆ†ç‰‡ç»´åº¦: chat_id (æˆ– session_id)
åˆ†ç‰‡ç®—æ³•: ä¸€è‡´æ€§å“ˆå¸Œæˆ–æ¨¡æ•°

åˆ†ç‰‡å‰:          åˆ†ç‰‡å:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ chat_message â”‚  â”‚ db0.chat_message_0  â”‚
â”‚   (1M è¡Œ)    â”‚  â”‚ db0.chat_message_1  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ db0.chat_message_2  â”‚
                  â”‚ db0.chat_message_3  â”‚
                  â”‚ db1.chat_message_0  â”‚
                  â”‚ db1.chat_message_1  â”‚
                  â”‚ db1.chat_message_2  â”‚
                  â”‚ db1.chat_message_3  â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®é‡ä» 1000ä¸‡ è¡Œåˆ†æ•£åˆ° 8 ä¸ªåˆ†ç‰‡
æ¯ä¸ªåˆ†ç‰‡ 125 ä¸‡è¡Œ
æŸ¥è¯¢æ€§èƒ½æå‡ 8 å€
```

**é…ç½®ç¤ºä¾‹**:

```yaml
spring:
  shardingsphere:
    datasource:
      names: ds_0,ds_1
      ds_0:
        type: com.zaxxer.hikari.HikariDataSource
        jdbc-url: jdbc:mysql://db1:3306/di_rag_0
        username: user
        password: pwd
      ds_1:
        type: com.zaxxer.hikari.HikariDataSource
        jdbc-url: jdbc:mysql://db2:3306/di_rag_1
        username: user
        password: pwd
    
    rules:
      sharding:
        tables:
          chat_message_tab:
            actual-data-nodes: ds_${0..1}.chat_message_${0..3}
            table-strategy:
              standard:
                sharding-column: chat_id
                sharding-algorithm-name: chat-hash
            key-generate-strategy:
              column: id
              key-generator-name: snowflake
        
        sharding-algorithms:
          chat-hash:
            type: HASH_MOD
            props:
              sharding-count: 8

rule-cache-init: true
```

### åœºæ™¯ 2: Feedback åé¦ˆè¡¨åˆ†ç‰‡

**éœ€æ±‚**: æ”¯æŒæŒ‰ç”¨æˆ·çš„å¤šåŒºåŸŸéƒ¨ç½²

```
æ•°æ®åˆ†å¸ƒ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æŒ‰ session_id åˆ†ç‰‡                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ db_sg: æ–°åŠ å¡ç”¨æˆ·åé¦ˆ (500ä¸‡)         â”‚
â”‚ db_us: ç¾å›½ç”¨æˆ·åé¦ˆ (300ä¸‡)           â”‚
â”‚ db_eu: æ¬§æ´²ç”¨æˆ·åé¦ˆ (200ä¸‡)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

SQL è‡ªåŠ¨è·¯ç”±:
SELECT * FROM feedback
WHERE session_id = 12345  â† è‡ªåŠ¨è·¯ç”±åˆ° db_sg
  AND user = 'user_sg'
```

**é…ç½®**:

```yaml
# feedback_tab åˆ†ç‰‡é…ç½®
feedback_tab:
  actual-data-nodes: db_${sg,us,eu}.feedback_${0..3}
  sharding-strategy:
    column: session_id
    algorithm: range-based  # èŒƒå›´åˆ†ç‰‡
```

### åœºæ™¯ 3: Session è¡¨åˆ†ç‰‡

**éœ€æ±‚**: å¤§é‡ç”¨æˆ·ä¼šè¯ç®¡ç†

```
ä¼šè¯æ•°é‡å¢é•¿:
æ—¶é—´         ä¼šè¯æ•°       æ€§èƒ½
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
2024å¹´åˆ    100ä¸‡      å“åº” 10ms
2024å¹´ä¸­    500ä¸‡      å“åº” 50ms (ä¸‹é™)
2024å¹´æœ«    1000ä¸‡     å“åº” 200ms (ä¸å¯ç”¨)

è§£å†³æ–¹æ¡ˆ: æŒ‰ç”¨æˆ·åˆ†ç‰‡
users_0 â†’ sessions_0,_1,_2,_3
users_1 â†’ sessions_0,_1,_2,_3
...
```

---

## ğŸ“Š åˆ†ç‰‡ç­–ç•¥è¯¦è§£

### åˆ†ç‰‡é”®é€‰æ‹©

| è¡¨ | åˆ†ç‰‡é”® | åŸå›  |
|-----|---------|------|
| chat_message_tab | chat_id | æ¶ˆæ¯æœ€å¸¸æŒ‰ chat æŸ¥è¯¢ |
| feedback_tab | session_id | åé¦ˆä¸ä¼šè¯ç»‘å®š |
| chat_session_tab | user | ä¼šè¯æŒ‰ç”¨æˆ·æŸ¥è¯¢ |
| user_tab | user_id | ç”¨æˆ·æœ€å¸¸æŸ¥è¯¢çš„ç»´åº¦ |

### åˆ†ç‰‡ç®—æ³•

#### 1. èŒƒå›´åˆ†ç‰‡ (Range)

```
åˆ†ç‰‡é”®å€¼: 1-1000000
â”‚
â”œâ”€ db_0: 1-250000
â”œâ”€ db_1: 250001-500000
â”œâ”€ db_2: 500001-750000
â””â”€ db_3: 750001-1000000

ä¼˜ç‚¹: èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ
ç¼ºç‚¹: æ•°æ®åˆ†å¸ƒå¯èƒ½ä¸å‡
```

#### 2. å“ˆå¸Œåˆ†ç‰‡ (Hash/Mod)

```
åˆ†ç‰‡é”®å€¼: 12345
â”‚
â”œâ”€ è®¡ç®—: 12345 % 4 = 1
â”œâ”€ ç›®æ ‡æ•°æ®åº“: db_1
â”‚
hash(chatId) â†’ ds_x.chat_message_y

ä¼˜ç‚¹: æ•°æ®åˆ†å¸ƒå‡åŒ€
ç¼ºç‚¹: èŒƒå›´æŸ¥è¯¢éœ€è¦è·¨åˆ†ç‰‡
```

#### 3. ä¸€è‡´æ€§å“ˆå¸Œ (Consistent Hash)

```
å“ˆå¸Œç¯:
        â”Œâ”€â”€â”€ db_0 â”€â”€â”€â”€â”€â”
       /                 \
    db_1                 db_3
      \                 /
        â””â”€â”€â”€ db_2 â”€â”€â”€â”€â”€â”˜

æ•°æ®å‡åŒ€åˆ†å¸ƒåœ¨ç¯ä¸Š
æ‰©å®¹æ—¶åªéœ€è¿ç§»éƒ¨åˆ†æ•°æ®
```

---

## ğŸ”„ è¯»å†™åˆ†ç¦»

### ä¸»ä»æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å†™å…¥è¯·æ±‚          â”‚
â”‚ INSERT/UPDATE/DELETE â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ ä¸»åº“ DB â”‚
      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
           â†“
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â†“              â†“
 â”Œâ”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”
 â”‚ä»åº“1 â”‚      â”‚ä»åº“2 â”‚
 â””â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”˜
    â†‘              â†‘
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ è¯»å–è¯·æ±‚   â”‚
      â”‚ SELECT ... â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### é…ç½®ç¤ºä¾‹

```yaml
sharding:
  master-slave-rules:
    chat_master_slave:
      master-data-source-name: master
      slave-data-source-names:
        - slave1
        - slave2
      load-balance-algorithm-name: round_robin
```

---

## ğŸŒ åœ°ç†åˆ†ç‰‡åœºæ™¯

### è·¨åŒºåŸŸéƒ¨ç½²

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DI-Assistant å…¨çƒéƒ¨ç½²         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Singapore (SG)                  â”‚  â”‚
â”‚  â”‚ - DB: db_sg (MySQL ä¸»)          â”‚  â”‚
â”‚  â”‚ - ç”¨æˆ·: äºšå¤ªåŒº                  â”‚  â”‚
â”‚  â”‚ - æ•°æ®: 500 ä¸‡ chat, 200 ä¸‡åé¦ˆ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ US East (US)                    â”‚  â”‚
â”‚  â”‚ - DB: db_us (MySQL ä¸»)          â”‚  â”‚
â”‚  â”‚ - ç”¨æˆ·: ç¾æ´²åŒº                  â”‚  â”‚
â”‚  â”‚ - æ•°æ®: 300 ä¸‡ chat, 150 ä¸‡åé¦ˆ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Europe (EU)                     â”‚  â”‚
â”‚  â”‚ - DB: db_eu (MySQL ä¸»)          â”‚  â”‚
â”‚  â”‚ - ç”¨æˆ·: æ¬§éåŒº                  â”‚  â”‚
â”‚  â”‚ - æ•°æ®: 200 ä¸‡ chat, 100 ä¸‡åé¦ˆ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

æ•°æ®å®Œå…¨éš”ç¦»ï¼Œç¬¦åˆæ•°æ®æœ¬åœ°åŒ–è¦æ±‚
```

---

## ğŸ“ˆ æ€§èƒ½å¯¹æ¯”

### åˆ†ç‰‡å‰åæ€§èƒ½å¯¹æ¯”

| æ“ä½œ | åˆ†ç‰‡å‰ | åˆ†ç‰‡å | æå‡ |
|-----|-------|--------|------|
| æŒ‰ chat_id æŸ¥è¯¢ (1M è¡Œæ‰«æ) | 500ms | 60ms | **8.3x** |
| æŒ‰ user æŸ¥è¯¢ (500K è¡Œæ‰«æ) | 250ms | 35ms | **7.1x** |
| åˆ†é¡µæŸ¥è¯¢ (LIMIT 1000) | 100ms | 12ms | **8.3x** |
| å…³è”æŸ¥è¯¢ (2 ä¸ªè¡¨) | 800ms | 120ms | **6.7x** |
| èšåˆæŸ¥è¯¢ (COUNT/SUM) | 300ms | 80ms | **3.75x** |

### å¹¶å‘æ”¯æŒæå‡

```
åˆ†ç‰‡å‰ (å•åº“):
- æœ€å¤§å¹¶å‘: 1000 QPS
- å“åº”æ—¶é—´: 100-500ms
- å³°å€¼æ—¶æœŸ: ç»å¸¸è¶…æ—¶

åˆ†ç‰‡å (4 åº“):
- æœ€å¤§å¹¶å‘: 4000 QPS (ç†è®º)
- å“åº”æ—¶é—´: 50-150ms
- å³°å€¼æ—¶æœŸ: ç¨³å®šè¿è¡Œ
```

---

## ğŸ” åˆ†å¸ƒå¼äº‹åŠ¡

### åœºæ™¯: åˆ é™¤ Chat åŒæ—¶åˆ é™¤ Feedback

```java
@Transactional
public void deleteChat(Long chatId) {
    // åˆ é™¤ Chat æ¶ˆæ¯
    chatMessageTabMapper.deleteById(chatId);
    
    // åˆ é™¤ Feedback
    feedbackTabMapper.deleteByChat(chatId);
    
    // åˆ é™¤ Session
    sessionTabMapper.deleteByChat(chatId);
}
```

**é—®é¢˜**: å¦‚æœæ•°æ®åˆ†æ•£åœ¨ä¸åŒåº“ï¼Œäº‹åŠ¡ä¼šå¤±æ•ˆ

**è§£å†³æ–¹æ¡ˆ**:

```yaml
# ShardingSphere åˆ†å¸ƒå¼äº‹åŠ¡é…ç½®
sharding:
  transaction:
    default: BASE      # åŸºäºå¯é æ¶ˆæ¯çš„æœ€ç»ˆä¸€è‡´æ€§
    props:
      sql-show: true
```

---

## ğŸ› ï¸ å¸¸è§é—®é¢˜

### Q1: åˆ†ç‰‡é”®é€‰æ‹©é”™è¯¯çš„åæœ?

```
âŒ é”™è¯¯é€‰æ‹©:
  - SELECT * FROM chat_message WHERE user_name = 'user1'
  - éœ€è¦æ‰«ææ‰€æœ‰åˆ†ç‰‡ (4 ä¸ªåº“ Ã— 4 ä¸ªè¡¨ = 16 ä¸ªæŸ¥è¯¢!)

âœ… æ­£ç¡®é€‰æ‹©:
  - SELECT * FROM chat_message WHERE chat_id = 123
  - è‡ªåŠ¨è·¯ç”±åˆ°å•ä¸ªåˆ†ç‰‡ (1 ä¸ªæŸ¥è¯¢)
```

### Q2: è·¨åˆ†ç‰‡æŸ¥è¯¢æ€§èƒ½?

```
æ€§èƒ½æ’åº (ä»é«˜åˆ°ä½):
1. å•åˆ†ç‰‡æŸ¥è¯¢ (æœ‰åˆ†ç‰‡é”®)       10ms
2. è·¨åˆ†ç‰‡æŸ¥è¯¢ (å…¨è¡¨æ‰«æ)       200ms
3. è·¨åˆ†ç‰‡å…³è”æŸ¥è¯¢ (æ¶‰åŠå¤šè¡¨)  500ms
4. è·¨åˆ†ç‰‡åˆ†ç»„èšåˆ (å¤æ‚è®¡ç®—)  1000ms+
```

### Q3: æ‰©å®¹å¦‚ä½•è¿ç§»æ•°æ®?

```
åŸå§‹é…ç½®: 4 ä¸ªåˆ†ç‰‡ (db_0-db_1, æ¯ä¸ª 2 å¼ è¡¨)
æ‰©å®¹åˆ°:   8 ä¸ªåˆ†ç‰‡ (db_0-db_3, æ¯ä¸ª 2 å¼ è¡¨)

è¿ç§»æ­¥éª¤:
1. æ–°å»º 4 ä¸ªåˆ†ç‰‡
2. ä½¿ç”¨ ElasticSearch æˆ– Datax è¿ç§»æ•°æ®
3. æ›´æ–°é…ç½®
4. éªŒè¯æ•°æ®å®Œæ•´æ€§
5. åˆ é™¤æ—§åˆ†ç‰‡
```

---

## ğŸ“ é…ç½®æ–‡ä»¶ä½ç½®

### æ•°æ®åº“é…ç½®

| æ–‡ä»¶ | ç¯å¢ƒ | ä¸»æœº | å¤‡æ³¨ |
|------|------|------|------|
| `application-live.yml` | ç”Ÿäº§ | `db-master-di-rag-sg1-live.shopeemobile.com` | æ–°åŠ å¡ |
| `application-staging.yml` | é¢„å‘ | `master.e6c41a4bc6553ce8.mysql.cloud.staging.shopee.io` | æµ‹è¯• |
| `application-local.yml` | å¼€å‘ | `master.e821f28ca694983e.mysql.cloud.test.shopee.io` | æœ¬åœ° |

### æ¨æµ‹çš„é…ç½®æ–‡ä»¶

```
di-assistant-service/src/main/resources/
â”œâ”€â”€ application.yml
â”œâ”€â”€ sharding-config.yml        (æ¨æµ‹)
â”œâ”€â”€ sharding-rules-dev.yml     (æ¨æµ‹)
â”œâ”€â”€ sharding-rules-prod.yml    (æ¨æµ‹)
â””â”€â”€ ...
```

---

## âœ… æ£€æŸ¥æ¸…å•

- [x] ShardingSphere ä¾èµ–å·²æ·»åŠ  (v4.1.1)
- [ ] åˆ†ç‰‡ç­–ç•¥å·²å®šä¹‰ï¼ˆå¾…ç¡®è®¤ï¼‰
- [ ] æ•°æ®åº“åˆ†ç‰‡å·²é…ç½®ï¼ˆå¾…ç¡®è®¤ï¼‰
- [ ] è¯»å†™åˆ†ç¦»å·²å¯ç”¨ï¼ˆå¾…ç¡®è®¤ï¼‰
- [ ] åˆ†å¸ƒå¼äº‹åŠ¡å·²é…ç½®ï¼ˆå¾…ç¡®è®¤ï¼‰
- [ ] åˆ†ç‰‡é”®éªŒè¯è§„åˆ™ï¼ˆå¾…å®ç°ï¼‰
- [ ] æ‰©å®¹è¿ç§»æ–¹æ¡ˆï¼ˆå¾…åˆ¶å®šï¼‰
- [ ] ç›‘æ§å‘Šè­¦ï¼ˆå¾…å®ç°ï¼‰

