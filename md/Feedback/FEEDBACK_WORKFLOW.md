# DI-Assistant Feedback æ¨¡å—å·¥ä½œæµä¸ä¸šåŠ¡æµç¨‹

## ä¸€ã€æ•´ä½“ä¸šåŠ¡æµç¨‹

### 1.1 ç”¨æˆ·åé¦ˆçš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸ

```
+â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+
â”‚                    ç”¨æˆ·åé¦ˆå®Œæ•´ç”Ÿå‘½å‘¨æœŸ                              â”‚
+â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€+

1ï¸âƒ£ åˆ›å»ºé˜¶æ®µ
   â”œâ”€ ç”¨æˆ·åœ¨å‰ç«¯çœ‹åˆ°èŠå¤©å›å¤
   â”œâ”€ é€‰æ‹©è¯„åˆ†ï¼ˆèµ/è¸©ï¼‰ + è¾“å…¥è¯„è®º
   â”œâ”€ ç‚¹å‡»"æäº¤åé¦ˆ"
   â””â”€ ç³»ç»Ÿåˆ›å»ºåé¦ˆè®°å½•
   
2ï¸âƒ£ ä¿®æ”¹é˜¶æ®µ
   â”œâ”€ ç”¨æˆ·ä¿®æ”¹å·²æäº¤çš„åé¦ˆ
   â”œâ”€ æ›´æ–°è¯„åˆ†æˆ–è¯„è®º
   â”œâ”€ ç‚¹å‡»"æ›´æ–°"
   â””â”€ ç³»ç»Ÿæ›´æ–°åé¦ˆè®°å½•
   
3ï¸âƒ£ åˆ é™¤é˜¶æ®µï¼ˆå¯é€‰ï¼‰
   â”œâ”€ ç”¨æˆ·æ’¤å›åé¦ˆ
   â”œâ”€ ç³»ç»Ÿæ ‡è®°ä¸ºå·²åˆ é™¤
   â””â”€ é€»è¾‘åˆ é™¤ï¼ˆä¿ç•™å†å²ï¼‰
   
4ï¸âƒ£ æŸ¥è¯¢é˜¶æ®µ
   â”œâ”€ å‰ç«¯æŸ¥è¯¢åé¦ˆä¿¡æ¯
   â”œâ”€ ç”¨äºå±•ç¤ºåé¦ˆçŠ¶æ€
   â””â”€ ç”¨äºç»Ÿè®¡åˆ†æ
```

### 1.2 åé¦ˆç±»å‹ä¸æ¥æº

```
åé¦ˆæ¥æºåˆ†ç±»
â”œâ”€â”€ POPUP ("popup")
â”‚   â””â”€ ç”¨æˆ·é€šè¿‡å¼¹çª—è¿›è¡Œåé¦ˆ
â”‚      ç¤ºä¾‹ï¼šç‚¹å‡»å¼¹çª—ä¸­çš„"æœ‰å¸®åŠ©"/"æ²¡å¸®åŠ©"æŒ‰é’®
â”‚
â””â”€â”€ RESPONSE_MESSAGE_BUTTON ("response-message-button")
    â””â”€ ç”¨æˆ·é€šè¿‡èŠå¤©æ¶ˆæ¯ä¸‹æ–¹æŒ‰é’®è¿›è¡Œåé¦ˆ
       ç¤ºä¾‹ï¼šç‚¹å‡»æ¶ˆæ¯æ—çš„"ğŸ‘"æˆ–"ğŸ‘"æŒ‰é’® [é»˜è®¤]
```

---

## äºŒã€åˆ›å»ºåé¦ˆå·¥ä½œæµ

### 2.1 è¯¦ç»†æµç¨‹å›¾

```
ç”¨æˆ·åœ¨å‰ç«¯ç•Œé¢æ“ä½œ
       â†“
POST /feedback/new
{
  "commonInfo": {...},
  "chatId": 12345,
  "sessionId": 67890,
  "ratting": 5,
  "comment": "å¾ˆæœ‰å¸®åŠ©",
  "feedbackSource": "response-message-button"
}
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FeedbackController.createFeedback()     â”‚
â”‚                                          â”‚
â”‚  1. æå–è¯·æ±‚å‚æ•°å’Œç”¨æˆ·ä¿¡æ¯              â”‚
â”‚  2. è°ƒç”¨ check() éªŒè¯æƒé™                â”‚
â”‚     - æ£€æŸ¥ sessionId æ˜¯å¦å­˜åœ¨            â”‚
â”‚     - æ£€æŸ¥ç”¨æˆ·æƒé™ï¼ˆæ‰€æœ‰è€…ï¼‰            â”‚
â”‚     - æ£€æŸ¥ chatId æ¶ˆæ¯æ˜¯å¦å­˜åœ¨          â”‚
â”‚  3. å¦‚æœéªŒè¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†              â”‚
â”‚  4. å¦‚æœéªŒè¯å¤±è´¥ï¼ŒæŠ›å‡ºå¼‚å¸¸              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚    æƒé™éªŒè¯è¯¦ç»†æ­¥éª¤ (check æ–¹æ³•)        â”‚
â”‚                                          â”‚
â”‚  Step 1: SessionService.getSession()     â”‚
â”‚  â””â”€ æ£€æŸ¥ session æ˜¯å¦å­˜åœ¨                â”‚
â”‚     if (sessionDetailDTO == null)        â”‚
â”‚         â†’ æŠ›å‡ºå¼‚å¸¸: "chat session not exist"
â”‚                                          â”‚
â”‚  Step 2: ç”¨æˆ·æƒé™æ£€æŸ¥                   â”‚
â”‚  â””â”€ æ£€æŸ¥ sessionDetailDTO.user == user   â”‚
â”‚     if (!user.equalsIgnoreCase(...))     â”‚
â”‚         â†’ æŠ›å‡ºå¼‚å¸¸: "session is owned by..."
â”‚                                          â”‚
â”‚  Step 3: ChatService.getChatDetail()     â”‚
â”‚  â””â”€ æ£€æŸ¥ chat æ¶ˆæ¯æ˜¯å¦å­˜åœ¨              â”‚
â”‚     if (chatDetailDTO == null)           â”‚
â”‚         â†’ æŠ›å‡ºå¼‚å¸¸: "chat message not exist"
â”‚                                          â”‚
â”‚  âœ“ æ‰€æœ‰éªŒè¯é€šè¿‡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FeedbackConvertor (Webå±‚)              â”‚
â”‚                                          â”‚
â”‚  è½¬æ¢: FeedbackCreateRequestVO           â”‚
â”‚        â†’ FeedbackCreateDTO               â”‚
â”‚                                          â”‚
â”‚  æ˜ å°„:                                    â”‚
â”‚  - commonInfo        â†’ commonInfo        â”‚
â”‚  - chatId            â†’ chatId            â”‚
â”‚  - sessionId         â†’ sessionId         â”‚
â”‚  - ratting           â†’ ratting           â”‚
â”‚  - comment           â†’ comment           â”‚
â”‚  - feedbackSource    â†’ FeedBackSourceTypeâ”‚
â”‚    (Stringè½¬æ¢ä¸ºEnum, é»˜è®¤å€¼)          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FeedbackService.createFeedback()       â”‚
â”‚                                          â”‚
â”‚  1. æ¥æ”¶ FeedbackCreateDTO               â”‚
â”‚  2. è°ƒç”¨ ChatFeedbackConvertor è½¬æ¢     â”‚
â”‚     FeedbackCreateDTO â†’ FeedbackTab      â”‚
â”‚  3. è®¾ç½®åˆ›å»ºæ—¶é—´                        â”‚
â”‚     feedbackTab.setCreateTime(...)       â”‚
â”‚  4. è°ƒç”¨ FeedbackTabServiceImpl           â”‚
â”‚     æ‰§è¡Œæ•°æ®åº“æ“ä½œ                      â”‚
â”‚  5. æ£€æŸ¥æ“ä½œç»“æœ                        â”‚
â”‚     if (ret == 0) â†’ å¼‚å¸¸                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackTabServiceImpl.createFeedback()   â”‚
â”‚                                          â”‚
â”‚  1. æ„å»ºæŸ¥è¯¢æ¡ä»¶                        â”‚
â”‚     queryWrapper.eq("chat_id", chatId)  â”‚
â”‚     queryWrapper.eq("delete_time", 0)   â”‚
â”‚                                          â”‚
â”‚  2. æ£€æŸ¥åé¦ˆæ˜¯å¦å·²å­˜åœ¨                  â”‚
â”‚     if (feedbackTabMapper.exists(...)) {â”‚
â”‚         return 0;  // å·²å­˜åœ¨, è¿”å›å¤±è´¥  â”‚
â”‚     }                                    â”‚
â”‚                                          â”‚
â”‚  3. æ’å…¥æ–°åé¦ˆ                          â”‚
â”‚     feedbackTabMapper.insert(feedbackTab)â”‚
â”‚     return è¡Œæ•° (æˆåŠŸ=1, å¤±è´¥=0)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     FeedbackTabMapper (MyBatis-Plus)    â”‚
â”‚                                          â”‚
â”‚  æ‰§è¡Œ SQL INSERT                         â”‚
â”‚                                          â”‚
â”‚  INSERT INTO feedback_tab (              â”‚
â”‚      chat_id, session_id, user_name,    â”‚
â”‚      ratting, comment, create_time,     â”‚
â”‚      delete_time, feedback_source       â”‚
â”‚  ) VALUES (...)                         â”‚
â”‚                                          â”‚
â”‚  è¿”å›: 1 (æ’å…¥æˆåŠŸ)                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
         æ•°æ®åº“
      (æ’å…¥æˆåŠŸ)
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  è¿”å›å€¼æµç¨‹                             â”‚
â”‚                                          â”‚
â”‚  FeedbackTab (åŒ…å«ç”Ÿæˆçš„ID)             â”‚
â”‚  â†’ ChatFeedbackConvertor                â”‚
â”‚  â†’ FeedbackDetailDTO                    â”‚
â”‚  â†’ FeedbackConvertor                    â”‚
â”‚  â†’ FeedbackDetailVO                     â”‚
â”‚  â†’ ResponseDTO<FeedbackDetailVO>        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    è¿”å›ç»™å‰ç«¯ (JSON)
{
  "code": 0,
  "data": {
    "feedbackId": 1001,
    "ratting": 5,
    "comment": "å¾ˆæœ‰å¸®åŠ©",
    "createTime": 1694865234567,
    "feedbackSource": "response-message-button"
  },
  "message": "success"
}
```

### 2.2 å…³é”®æ£€æŸ¥ç‚¹

| æ£€æŸ¥é¡¹ | æ‰§è¡Œä½ç½® | å¤±è´¥å¤„ç† | é”™è¯¯ä»£ç  |
|--------|---------|---------|---------|
| Session å­˜åœ¨æ€§ | Controller.check() | å¼‚å¸¸ | PARAM_ILLEGAL |
| ç”¨æˆ·æƒé™ | Controller.check() | å¼‚å¸¸ | PARAM_ILLEGAL |
| Chat æ¶ˆæ¯å­˜åœ¨æ€§ | Controller.check() | å¼‚å¸¸ | PARAM_ILLEGAL |
| åé¦ˆé‡å¤æ€§ | ServiceImpl.createFeedback() | è¿”å›0 | MYSQL_SAVE_ERROR |
| æ•°æ®åº“æ’å…¥ | ServiceImpl.createFeedback() | è¿”å›0 | MYSQL_SAVE_ERROR |

---

## ä¸‰ã€ä¿®æ”¹åé¦ˆå·¥ä½œæµ

### 3.1 è¯¦ç»†æµç¨‹å›¾

```
ç”¨æˆ·ä¿®æ”¹å·²æäº¤çš„åé¦ˆ
       â†“
PUT /feedback/update
{
  "feedbackId": 1001,
  "ratting": 4,
  "comment": "è¿˜ä¸é”™ï¼Œä½†æœ‰ç‚¹å†—é•¿"
}
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FeedbackController.modifyFeedback()     â”‚
â”‚                                          â”‚
â”‚  1. æå–åé¦ˆID                          â”‚
â”‚  2. è°ƒç”¨ FeedbackService.getFeedback()   â”‚
â”‚     è·å–ç°æœ‰åé¦ˆä¿¡æ¯                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FeedbackService.getFeedback()          â”‚
â”‚                                          â”‚
â”‚  1. æ„å»ºæŸ¥è¯¢æ¡ä»¶                        â”‚
â”‚     - id = feedbackId                   â”‚
â”‚     - delete_time = 0 (æœªåˆ é™¤)          â”‚
â”‚  2. æŸ¥è¯¢æ•°æ®åº“                          â”‚
â”‚  3. å¦‚æœæ‰¾ä¸åˆ°                          â”‚
â”‚     â†’ æŠ›å‡ºå¼‚å¸¸: MYSQL_DATA_NOT_FOUND    â”‚
â”‚  4. è½¬æ¢ä¸º FeedbackDetailDTO             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æƒé™éªŒè¯ (check æ–¹æ³•)                  â”‚
â”‚                                          â”‚
â”‚  ä½¿ç”¨æŸ¥è¯¢åˆ°çš„ chatId å’Œ sessionId        â”‚
â”‚  æ‰§è¡Œç›¸åŒçš„æƒé™æ£€æŸ¥:                    â”‚
â”‚  1. Session å­˜åœ¨æ€§                      â”‚
â”‚  2. ç”¨æˆ·æƒé™                            â”‚
â”‚  3. Chat æ¶ˆæ¯å­˜åœ¨æ€§                     â”‚
â”‚                                          â”‚
â”‚  âœ“ æƒé™éªŒè¯é€šè¿‡                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FeedbackConvertor (Webå±‚)               â”‚
â”‚                                          â”‚
â”‚  è½¬æ¢: FeedbackModifyRequestVO           â”‚
â”‚        â†’ FeedbackModifyDTO               â”‚
â”‚                                          â”‚
â”‚  æ˜ å°„:                                    â”‚
â”‚  - feedbackId  â†’ feedbackId              â”‚
â”‚  - ratting     â†’ ratting                 â”‚
â”‚  - comment     â†’ comment (å¯é€‰)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FeedbackService.modifyFeedback()        â”‚
â”‚                                          â”‚
â”‚  1. è°ƒç”¨ FeedbackTabServiceImpl           â”‚
â”‚     æ‰§è¡Œæ›´æ–°æ“ä½œ                        â”‚
â”‚  2. æ£€æŸ¥æ“ä½œç»“æœ                        â”‚
â”‚     if (ret == 0) â†’ å¼‚å¸¸                 â”‚
â”‚  3. é‡æ–°æŸ¥è¯¢æ›´æ–°åçš„åé¦ˆ                â”‚
â”‚     getFeedback(feedbackId)              â”‚
â”‚  4. è¿”å› FeedbackDetailDTO               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackTabServiceImpl.modifyFeedback()   â”‚
â”‚                                          â”‚
â”‚  1. æ„å»ºæ›´æ–°æ¡ä»¶                        â”‚
â”‚     updateWrapper.set("ratting", 4)     â”‚
â”‚     updateWrapper.set("comment", "...")  â”‚
â”‚     updateWrapper.eq("id", 1001)        â”‚
â”‚                                          â”‚
â”‚  2. æ‰§è¡Œæ›´æ–°                            â”‚
â”‚     feedbackTabMapper.update(wrapper)   â”‚
â”‚                                          â”‚
â”‚  3. è¿”å›æ›´æ–°è¡Œæ•° (1=æˆåŠŸ, 0=å¤±è´¥)      â”‚
â”‚                                          â”‚
â”‚  æ³¨æ„: comment ä»…åœ¨é null æ—¶æ›´æ–°      â”‚
â”‚        æ”¯æŒéƒ¨åˆ†æ›´æ–°ï¼ˆåªæ”¹è¯„åˆ†ï¼‰         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
         æ•°æ®åº“
      (æ›´æ–°æˆåŠŸ)
           â†“
    è¿”å›ç»™å‰ç«¯ (JSON)
{
  "code": 0,
  "data": {
    "feedbackId": 1001,
    "ratting": 4,
    "comment": "è¿˜ä¸é”™ï¼Œä½†æœ‰ç‚¹å†—é•¿",
    "createTime": 1694865234567,
    "feedbackSource": "response-message-button"
  },
  "message": "success"
}
```

### 3.2 æ›´æ–°é€»è¾‘ç‰¹ç‚¹

```
æ›´æ–°å­—æ®µå¤„ç†

1. ratting å­—æ®µ
   â”œâ”€ æ€»æ˜¯è¢«æ›´æ–°
   â”œâ”€ å³ä½¿å‰ç«¯æœªæä¾›ä¹Ÿéœ€è¦æä¾›
   â””â”€ ç¤ºä¾‹: updateWrapper.set("ratting", 4)

2. comment å­—æ®µ
   â”œâ”€ ä»…å½“ä¸ä¸º null æ—¶æ›´æ–°
   â”œâ”€ æ”¯æŒç½®ç©ºï¼ˆcomment=""ï¼‰
   â”œâ”€ å¯ä»¥åªæ”¹è¯„åˆ†ä¸æ”¹è¯„è®º
   â””â”€ if (comment != null) {
       updateWrapper.set("comment", comment)
     }

3. å…¶ä»–å­—æ®µ
   â”œâ”€ createTime ä¸å˜
   â”œâ”€ deleteTime ä¸å˜ (éåˆ é™¤çŠ¶æ€ä¸‹)
   â”œâ”€ feedbackSource ä¸å˜
   â””â”€ userName ä¸å˜
```

---

## å››ã€åˆ é™¤åé¦ˆå·¥ä½œæµ

### 4.1 é€»è¾‘åˆ é™¤æµç¨‹

```
ç”¨æˆ·æ’¤å›åé¦ˆ (Serviceå±‚æ”¯æŒï¼Œä½†Controlleræœªæš´éœ²)
       â†“
FeedbackService.deleteFeedback(feedbackId)
       â†“
FeedbackTabServiceImpl.deleteFeedback(feedbackId)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   é€»è¾‘åˆ é™¤å®ç°                           â”‚
â”‚                                          â”‚
â”‚  UpdateWrapper updateWrapper = new ...  â”‚
â”‚  updateWrapper.set("delete_time",       â”‚
â”‚      System.currentTimeMillis())        â”‚
â”‚  updateWrapper.eq("delete_time", 0)     â”‚
â”‚  updateWrapper.eq("id", feedbackId)     â”‚
â”‚                                          â”‚
â”‚  feedbackTabMapper.update(updateWrapper)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
    UPDATE feedback_tab
    SET delete_time = [å½“å‰æ—¶é—´æˆ³]
    WHERE id = feedbackId
      AND delete_time = 0
           â†“
    è¿”å›: 1 (æˆåŠŸ) æˆ– 0 (å¤±è´¥/ä¸å­˜åœ¨)
           â†“
    é€»è¾‘åˆ é™¤æ ‡è®°
    âœ“ delete_time != 0 è¡¨ç¤ºå·²åˆ é™¤
    âœ“ æ•°æ®æœªç‰©ç†åˆ é™¤ï¼Œå¯æ¢å¤
    âœ“ åç»­æŸ¥è¯¢è‡ªåŠ¨è¿‡æ»¤
```

### 4.2 é€»è¾‘åˆ é™¤çš„å¥½å¤„

| ä¼˜ç‚¹ | è¯´æ˜ |
|------|------|
| **æ•°æ®å¯æ¢å¤** | å¦‚éœ€è¦ï¼Œå¯æ ¹æ® delete_time = 0 çš„æ¡ä»¶å–æ¶ˆåˆ é™¤ |
| **å®¡è®¡è¿½è¸ª** | ä¿ç•™åˆ é™¤æ—¶é—´ï¼Œä¾¿äºå®¡è®¡å’Œæ—¥å¿—åˆ†æ |
| **ç»Ÿè®¡å‡†ç¡®** | å†å²ç»Ÿè®¡æ•°æ®ä¸å—åˆ é™¤å½±å“ |
| **å…³ç³»å®Œæ•´æ€§** | é¿å…å¤–é”®çº§è”åˆ é™¤é—®é¢˜ |
| **æ€§èƒ½** | ä¸éœ€è¦é‡å»ºç´¢å¼•ï¼Œæ›´æ–°æ“ä½œå¾ˆå¿« |

---

## äº”ã€æŸ¥è¯¢åé¦ˆå·¥ä½œæµ

### 5.1 æŒ‰ ID æŸ¥è¯¢

```
åœºæ™¯: ä¿®æ”¹åé¦ˆæ—¶éœ€è¦å…ˆæŸ¥è¯¢ç°æœ‰å†…å®¹

FeedbackService.getFeedback(feedbackId)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FeedbackTabServiceImpl.getFeedback()     â”‚
â”‚                                          â”‚
â”‚  æ„å»ºæŸ¥è¯¢æ¡ä»¶:                           â”‚
â”‚  - QueryWrapper queryWrapper = new ...   â”‚
â”‚  - queryWrapper.eq("id", feedbackId)    â”‚
â”‚  - queryWrapper.eq("delete_time", 0)    â”‚
â”‚    â”œâ”€ åªæŸ¥è¯¢æœªåˆ é™¤çš„åé¦ˆ                â”‚
â”‚    â””â”€ å·²åˆ é™¤çš„è¿”å› null                 â”‚
â”‚                                          â”‚
â”‚  æ‰§è¡ŒæŸ¥è¯¢:                               â”‚
â”‚  feedbackTabMapper.selectOne(queryWrapper)â”‚
â”‚                                          â”‚
â”‚  è¿”å›: FeedbackTab æˆ– null               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
        æ•°æ®åº“æŸ¥è¯¢
           â†“
   SELECT * FROM feedback_tab
   WHERE id = 1001
     AND delete_time = 0
   LIMIT 1
           â†“
    FeedbackTab (æˆ– null)
           â†“
    å¼‚å¸¸å¤„ç† (Serviceå±‚)
    if (feedbackTab == null) {
        throw new ServerException(
            ResponseCodeEnum.MYSQL_DATA_NOT_FOUND,
            "FeedbackId : 1001 data not found"
        )
    }
```

### 5.2 æŒ‰ä¼šè¯æŸ¥è¯¢

```
åœºæ™¯: å‰ç«¯æŸ¥è¯¢ç‰¹å®šä¼šè¯çš„åé¦ˆ

FeedbackService.getFeedbackBySession(chatId, sessionId)
       â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackTabServiceImpl.getFeedbackBySession â”‚
â”‚                                          â”‚
â”‚  æ„å»ºæŸ¥è¯¢æ¡ä»¶:                           â”‚
â”‚  - QueryWrapper queryWrapper = new ...   â”‚
â”‚  - queryWrapper.eq("chat_id", chatId)   â”‚
â”‚  - queryWrapper.eq("session_id", sessionId) â”‚
â”‚    â”œâ”€ ä¸€æ¡ chat_id å¯¹åº”ä¸€ä¸ªåé¦ˆ         â”‚
â”‚    â””â”€ è¿”å›è¯¥åé¦ˆæˆ– null                 â”‚
â”‚                                          â”‚
â”‚  æ³¨æ„: æ­¤æ–¹æ³•ä¸è¿‡æ»¤ delete_time          â”‚
â”‚  å¯èƒ½è¿”å›å·²åˆ é™¤çš„åé¦ˆ                   â”‚
â”‚                                          â”‚
â”‚  è¿”å›: FeedbackTab æˆ– null               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
        æ•°æ®åº“æŸ¥è¯¢
           â†“
   SELECT * FROM feedback_tab
   WHERE chat_id = 12345
     AND session_id = 67890
   LIMIT 1
           â†“
    FeedbackTab (æˆ– null)
           â†“
    è¿”å›ç»™å‰ç«¯
```

---

## å…­ã€æƒé™éªŒè¯è¯¦è§£

### 6.1 éªŒè¯æµç¨‹

```
æƒé™éªŒè¯æ ¸å¿ƒé€»è¾‘ (FeedbackController.check æ–¹æ³•)

check(chatId, sessionId, user)
â”œâ”€ å‚æ•°è¯´æ˜:
â”‚  â”œâ”€ chatId: èŠå¤©æ¶ˆæ¯ID
â”‚  â”œâ”€ sessionId: èŠå¤©ä¼šè¯ID
â”‚  â””â”€ user: å½“å‰ç”¨æˆ· (ä»è¯·æ±‚å¤´ CommonRequest è·å–)
â”‚
â”œâ”€ ç¬¬ä¸€æ­¥: Session å­˜åœ¨æ€§æ£€æŸ¥
â”‚  â”‚
â”‚  â”œâ”€ sessionDetailDTO = sessionService.getSession(sessionId)
â”‚  â”‚
â”‚  â”œâ”€ if (sessionDetailDTO == null) {
â”‚  â”‚       throw new ServerException(
â”‚  â”‚           ResponseCodeEnum.PARAM_ILLEGAL,
â”‚  â”‚           "chat session not exist " + chatId
â”‚  â”‚       )
â”‚  â”‚   }
â”‚  â”‚
â”‚  â””â”€ ç»“æœ: Session å¿…é¡»å­˜åœ¨ï¼Œå¦åˆ™æ— æ³•ç»§ç»­
â”‚
â”œâ”€ ç¬¬äºŒæ­¥: ç”¨æˆ·æƒé™æ£€æŸ¥
â”‚  â”‚
â”‚  â”œâ”€ if (!StringUtils.equalsIgnoreCase(
â”‚  â”‚       sessionDetailDTO.getUser(), 
â”‚  â”‚       user)) {
â”‚  â”‚
â”‚  â”œâ”€ å¼‚å¸¸: ServerException(
â”‚  â”‚     ResponseCodeEnum.PARAM_ILLEGAL,
â”‚  â”‚     "the session is owned by the: " + sessionDetailDTO.getUser()
â”‚  â”‚  )
â”‚  â”‚
â”‚  â”œâ”€ è¯´æ˜: 
â”‚  â”‚  - æ¯”è¾ƒä¸åŒºåˆ†å¤§å°å†™
â”‚  â”‚  - åªæœ‰ session æ‰€æœ‰è€…å¯ä»¥å¯¹è¯¥ session çš„åé¦ˆæ“ä½œ
â”‚  â”‚
â”‚  â””â”€ ç»“æœ: æƒé™æ£€æŸ¥é€šè¿‡æˆ–å¼‚å¸¸
â”‚
â”œâ”€ ç¬¬ä¸‰æ­¥: Chat æ¶ˆæ¯å­˜åœ¨æ€§æ£€æŸ¥
â”‚  â”‚
â”‚  â”œâ”€ chatDetailDTO = chatService.getChatDetail(chatId)
â”‚  â”‚
â”‚  â”œâ”€ if (chatDetailDTO == null) {
â”‚  â”‚       throw new ServerException(
â”‚  â”‚           ResponseCodeEnum.PARAM_ILLEGAL,
â”‚  â”‚           "chat message not exist " + chatId
â”‚  â”‚       )
â”‚  â”‚   }
â”‚  â”‚
â”‚  â””â”€ ç»“æœ: Chat æ¶ˆæ¯å¿…é¡»å­˜åœ¨
â”‚
â””â”€ æ‰€æœ‰æ£€æŸ¥é€šè¿‡: å¯ä»¥ç»§ç»­ä¸šåŠ¡æ“ä½œ
```

### 6.2 æƒé™æ£€æŸ¥çŸ©é˜µ

```
åœºæ™¯åˆ†æ

åœºæ™¯1: ç”¨æˆ· A å¯¹è‡ªå·±çš„ä¼šè¯è¿›è¡Œåé¦ˆ âœ“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session æ‰€æœ‰è€… = User A              â”‚
â”‚ å½“å‰ç”¨æˆ· = User A                    â”‚
â”‚ Session å­˜åœ¨ = âœ“                     â”‚
â”‚ Chat æ¶ˆæ¯å­˜åœ¨ = âœ“                    â”‚
â”‚ æƒé™éªŒè¯ = âœ“ PASS                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯2: ç”¨æˆ· B å°è¯•å¯¹ç”¨æˆ· A çš„ä¼šè¯è¿›è¡Œåé¦ˆ âœ—
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session æ‰€æœ‰è€… = User A              â”‚
â”‚ å½“å‰ç”¨æˆ· = User B                    â”‚
â”‚ Session å­˜åœ¨ = âœ“                     â”‚
â”‚ Chat æ¶ˆæ¯å­˜åœ¨ = âœ“                    â”‚
â”‚ æƒé™éªŒè¯ = âœ— FAIL                   â”‚
â”‚ å¼‚å¸¸ä¿¡æ¯: "session is owned by: A"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯3: Session ä¸å­˜åœ¨ âœ—
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ SessionId = éå­˜åœ¨çš„ID               â”‚
â”‚ æƒé™éªŒè¯ = âœ— FAIL                   â”‚
â”‚ å¼‚å¸¸ä¿¡æ¯: "chat session not exist"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

åœºæ™¯4: Chat æ¶ˆæ¯ä¸å­˜åœ¨ âœ—
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Session æ‰€æœ‰è€… = User A              â”‚
â”‚ å½“å‰ç”¨æˆ· = User A                    â”‚
â”‚ ChatId = éå­˜åœ¨çš„ID                  â”‚
â”‚ æƒé™éªŒè¯ = âœ— FAIL                   â”‚
â”‚ å¼‚å¸¸ä¿¡æ¯: "chat message not exist"   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸ƒã€é”™è¯¯å¤„ç†ä¸å¼‚å¸¸

### 7.1 å¼‚å¸¸ç±»å‹ä¸å¤„ç†

```
å¼‚å¸¸å¤„ç†æµç¨‹

æ‰€æœ‰ä¸šåŠ¡å¼‚å¸¸ â†’ ServerException â†’ HTTP å“åº”

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          å¼‚å¸¸æ˜ å°„è¡¨                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ å¼‚å¸¸ç±»å‹ | çŠ¶æ€ç  | æ¶ˆæ¯ | å¯èƒ½åŸå›         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ PARAM_ILLEGAL | 40001 | å‚æ•°ä¸åˆæ³• |
â”‚       - Session ä¸å­˜åœ¨                     â”‚
â”‚       - ç”¨æˆ·æ— æƒé™                        â”‚
â”‚       - Chat æ¶ˆæ¯ä¸å­˜åœ¨                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MYSQL_SAVE_ERROR | 50001 | ä¿å­˜å¤±è´¥ |
â”‚       - åé¦ˆå·²å­˜åœ¨ (chat_id é‡å¤)         â”‚
â”‚       - æ•°æ®åº“æ’å…¥å¤±è´¥                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MYSQL_DELETE_ERROR | 50002 | åˆ é™¤å¤±è´¥ |
â”‚       - åé¦ˆ ID ä¸å­˜åœ¨                    â”‚
â”‚       - åé¦ˆå·²è¢«åˆ é™¤                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ MYSQL_DATA_NOT_FOUND | 50003 | æ•°æ®ä¸å­˜åœ¨ |
â”‚       - æŸ¥è¯¢åé¦ˆä¸å­˜åœ¨                    â”‚
â”‚       - ä¿®æ”¹åé¦ˆå¤±è´¥                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 7.2 é”™è¯¯å“åº”ç¤ºä¾‹

```json
åœºæ™¯1: Session ä¸å­˜åœ¨
{
  "code": 40001,
  "message": "chat session not exist 12345",
  "data": null
}

åœºæ™¯2: ç”¨æˆ·æ— æƒé™
{
  "code": 40001,
  "message": "the session is owned by the: user_a",
  "data": null
}

åœºæ™¯3: åé¦ˆå·²å­˜åœ¨
{
  "code": 50001,
  "message": "Feedback message save data error",
  "data": null
}

åœºæ™¯4: ä¿®æ”¹åé¦ˆå¤±è´¥
{
  "code": 50003,
  "message": "FeedbackId : 1001 update error",
  "data": null
}

åœºæ™¯5: æŸ¥è¯¢åé¦ˆä¸å­˜åœ¨
{
  "code": 50003,
  "message": "FeedbackId : 1001 data not found",
  "data": null
}
```

---

## å…«ã€æ•°æ®è½¬æ¢æµç¨‹è¯¦è§£

### 8.1 åˆ›å»ºåé¦ˆçš„è½¬æ¢æµç¨‹

```
Web å±‚è½¬æ¢ (FeedbackConvertor)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackCreateRequestVO                â”‚
â”‚ â”œâ”€ commonInfo: {user, email, ...}      â”‚
â”‚ â”œâ”€ chatId: 12345                       â”‚
â”‚ â”œâ”€ sessionId: 67890                    â”‚
â”‚ â”œâ”€ ratting: 5                          â”‚
â”‚ â”œâ”€ comment: "å¾ˆæœ‰å¸®åŠ©"                 â”‚
â”‚ â””â”€ feedbackSource: "response-message..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
    (MapStruct æ˜ å°„)
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackCreateDTO                      â”‚
â”‚ â”œâ”€ commonInfo: {user, email, ...}      â”‚
â”‚ â”œâ”€ chatId: 12345                       â”‚
â”‚ â”œâ”€ sessionId: 67890                    â”‚
â”‚ â”œâ”€ ratting: 5                          â”‚
â”‚ â”œâ”€ comment: "å¾ˆæœ‰å¸®åŠ©"                 â”‚
â”‚ â””â”€ feedbackSource: FeedBackSourceType  â”‚
â”‚    (RESPONSE_MESSAGE_BUTTON)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Service å±‚è½¬æ¢ (ChatFeedbackConvertor)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackTab (JPA Entity)               â”‚
â”‚ â”œâ”€ id: ç”Ÿæˆ (AUTO_INCREMENT)          â”‚
â”‚ â”œâ”€ chatId: 12345                       â”‚
â”‚ â”œâ”€ sessionId: 67890                    â”‚
â”‚ â”œâ”€ userName: "user_a" (ä»commonInfo)  â”‚
â”‚ â”œâ”€ ratting: 5                          â”‚
â”‚ â”œâ”€ comment: "å¾ˆæœ‰å¸®åŠ©"                 â”‚
â”‚ â”œâ”€ createTime: 1694865234567           â”‚
â”‚ â”œâ”€ deleteTime: 0                       â”‚
â”‚ â””â”€ feedbackSource: "response-message..." â”‚
â”‚    (Enumè½¬String)                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
    (æ’å…¥æ•°æ®åº“)
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackDetailDTO (è¿”å›å¯¹è±¡)           â”‚
â”‚ â”œâ”€ feedbackId: 1001 (ä»id)            â”‚
â”‚ â”œâ”€ sessionId: 67890                    â”‚
â”‚ â”œâ”€ chatId: 12345                       â”‚
â”‚ â”œâ”€ ratting: 5                          â”‚
â”‚ â”œâ”€ comment: "å¾ˆæœ‰å¸®åŠ©"                 â”‚
â”‚ â”œâ”€ createTime: 1694865234567           â”‚
â”‚ â””â”€ feedbackSource: "response-message..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
    (MapStruct æ˜ å°„)
             â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FeedbackDetailVO (å‰ç«¯å“åº”)            â”‚
â”‚ â”œâ”€ feedbackId: 1001                    â”‚
â”‚ â”œâ”€ ratting: 5                          â”‚
â”‚ â”œâ”€ comment: "å¾ˆæœ‰å¸®åŠ©"                 â”‚
â”‚ â”œâ”€ createTime: 1694865234567           â”‚
â”‚ â””â”€ feedbackSource: "response-message..." â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â†“
    è¿”å›ç»™å‰ç«¯ (JSON)
```

### 8.2 è½¬æ¢æ˜ å°„è§„åˆ™

```
Web å±‚æ˜ å°„è§„åˆ™ (FeedbackCreateRequestVO â†’ FeedbackCreateDTO)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @Mapping(target = "feedbackSource",                 â”‚
â”‚   expression = "java(getSourceType(...))")          â”‚
â”‚                                                     â”‚
â”‚ String feedbackSource (Input)                       â”‚
â”‚   â†’ FeedBackSourceType feedbackSource (Output)      â”‚
â”‚                                                     â”‚
â”‚ getSourceType() æ–¹æ³•:                                â”‚
â”‚ if (feedbackSource != null) {                       â”‚
â”‚     return FeedBackSourceType.valueOfString(...)   â”‚
â”‚ } else {                                            â”‚
â”‚     return FeedBackSourceType.RESPONSE_MESSAGE_BUTTON â”‚
â”‚ }                                                   â”‚
â”‚                                                     â”‚
â”‚ é»˜è®¤å€¼: RESPONSE_MESSAGE_BUTTON                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Service å±‚æ˜ å°„è§„åˆ™ (FeedbackCreateDTO â†’ FeedbackTab)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ @Mapping(source = "commonInfo.user",                â”‚
â”‚          target = "userName")                       â”‚
â”‚ â””â”€ åµŒå¥—å±æ€§æ˜ å°„                                      â”‚
â”‚
â”‚ @Mapping(source = "feedbackSource",                 â”‚
â”‚          target = "feedbackSource",                 â”‚
â”‚          qualifiedByName = "getSourceTypeUtil")     â”‚
â”‚ â””â”€ Enum â†’ String è½¬æ¢                               â”‚
â”‚    getSourceType() è¿”å› feedBackSourceType.getType()â”‚
â”‚    é»˜è®¤å€¼: FeedBackSourceType.RESPONSE_MESSAGE_BUTTON.getType() â”‚
â”‚                                                     â”‚
â”‚ Entity å±‚æ˜ å°„è§„åˆ™ (FeedbackTab â†’ FeedbackDetailDTO) â”‚
â”‚ @Mapping(source = "id",                             â”‚
â”‚          target = "feedbackId")                     â”‚
â”‚ â””â”€ ID å­—æ®µé‡æ˜ å°„                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¹ã€å¹¶å‘ä¸ä¸€è‡´æ€§è€ƒè™‘

### 9.1 ä¸€æ¡æ¶ˆæ¯ä¸€ä¸ªåé¦ˆçš„å®ç°

```
é—®é¢˜: é˜²æ­¢ç”¨æˆ·å¯¹åŒä¸€èŠå¤©æ¶ˆæ¯æäº¤å¤šä¸ªåé¦ˆ

è§£å†³æ–¹æ¡ˆ: åˆ›å»ºå‰æ£€æŸ¥ chat_id å”¯ä¸€æ€§

@Override
public int createFeedback(FeedbackTab feedbackTab) {
    // 1. æ„å»ºæŸ¥è¯¢æ¡ä»¶
    QueryWrapper<FeedbackTab> queryWrapper = new QueryWrapper<>();
    queryWrapper.eq("chat_id", feedbackTab.getChatId());
    queryWrapper.eq("delete_time", 0);  // æœªåˆ é™¤çš„åé¦ˆ
    
    // 2. æ£€æŸ¥æ˜¯å¦å·²å­˜åœ¨åé¦ˆ
    if (feedbackTabMapper.exists(queryWrapper)) {
        return 0;  // å·²å­˜åœ¨ï¼Œè¿”å›å¤±è´¥
    }
    
    // 3. æ’å…¥æ–°åé¦ˆ
    return feedbackTabMapper.insert(feedbackTab);
}

æ•°æ®åº“å±‚é¢ä¿éšœ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ è™½ç„¶æœªåˆ›å»ºå”¯ä¸€ç´¢å¼•ï¼Œä½†é€šè¿‡åº”ç”¨å±‚æ£€æŸ¥ â”‚
â”‚ ç¡®ä¿ä¸€æ¡æ¶ˆæ¯æœ€å¤šä¸€ä¸ªåé¦ˆï¼ˆæœªåˆ é™¤ï¼‰   â”‚
â”‚                                      â”‚
â”‚ åœºæ™¯åˆ†æ:                            â”‚
â”‚ 1. é¦–æ¬¡æäº¤åé¦ˆ â†’ é€šè¿‡æ£€æŸ¥ â†’ æ’å…¥   â”‚
â”‚ 2. ä¿®æ”¹åé¦ˆ â†’ ä¸å†åˆ›å»º â†’ åªæ›´æ–°     â”‚
â”‚ 3. åˆ é™¤åé¦ˆ â†’ æ ‡è®° delete_time       â”‚
â”‚ 4. å†æ¬¡æäº¤åé¦ˆ â†’ é€šè¿‡æ£€æŸ¥ â†’ æ’å…¥   â”‚
â”‚   (å› ä¸ºå‰ä¸€æ¡å·²è¢«æ ‡è®°ä¸ºåˆ é™¤)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 9.2 äº‹åŠ¡ä¸€è‡´æ€§

```
äº‹åŠ¡å¤„ç† (å•ä¸ªæ“ä½œ)

åˆ›å»ºæ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEGIN TRANSACTION                   â”‚
â”‚ â”œâ”€ SELECT æ£€æŸ¥é‡å¤                  â”‚
â”‚ â”œâ”€ INSERT åˆ›å»ºåé¦ˆ                  â”‚
â”‚ â””â”€ COMMIT                           â”‚
â”‚ å¦‚æœä»»ä½•æ­¥éª¤å¤±è´¥ï¼Œè‡ªåŠ¨ ROLLBACK     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

ä¿®æ”¹æ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ BEGIN TRANSACTION                   â”‚
â”‚ â”œâ”€ UPDATE æ›´æ–°åé¦ˆ                  â”‚
â”‚ â””â”€ COMMIT                           â”‚
â”‚ å¦‚æœ UPDATE å¤±è´¥ï¼Œè‡ªåŠ¨ ROLLBACK     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

è·¨å¤šä¸ªè¡¨çš„æ“ä½œ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æƒé™æ£€æŸ¥ (Session/Chat æŸ¥è¯¢)        â”‚
â”‚ ä¸šåŠ¡æ“ä½œ (åé¦ˆåˆ›å»º/ä¿®æ”¹)            â”‚
â”‚                                     â”‚
â”‚ æ³¨æ„: æƒé™æ£€æŸ¥ä¸ä¸šåŠ¡æ“ä½œåˆ†å¼€        â”‚
â”‚ ä¸åœ¨åŒä¸€ä¸ªäº‹åŠ¡ä¸­                    â”‚
â”‚ å¯èƒ½å­˜åœ¨å¹¶å‘ä¿®æ”¹çš„æƒ…å†µ              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## åã€æ€§èƒ½ä¼˜åŒ–å»ºè®®

### 10.1 å½“å‰æ€§èƒ½ç‰¹ç‚¹

| æ“ä½œ | æ—¶é—´å¤æ‚åº¦ | ä¼˜åŒ–ç©ºé—´ |
|------|---------|--------|
| åˆ›å»ºåé¦ˆ | O(1) | å¯æ·»åŠ ç´¢å¼•åŠ é€Ÿæ£€æŸ¥ |
| ä¿®æ”¹åé¦ˆ | O(1) | å·²ä¼˜åŒ– |
| åˆ é™¤åé¦ˆ | O(1) | å·²ä¼˜åŒ– |
| æŒ‰IDæŸ¥è¯¢ | O(1) | å·²æœ‰ä¸»é”®ç´¢å¼• |
| æŒ‰ä¼šè¯æŸ¥è¯¢ | O(1) | å»ºè®®åŠ  (chat_id, session_id) ç´¢å¼• |

### 10.2 å»ºè®®ç´¢å¼•

```sql
-- å½“å‰æƒ…å†µï¼ˆä»…ä¸»é”®ï¼‰
CREATE TABLE feedback_tab (
    id BIGINT PRIMARY KEY AUTO_INCREMENT,
    ...
)

-- å»ºè®®æ·»åŠ çš„ç´¢å¼•
CREATE INDEX idx_chat_id 
    ON feedback_tab(chat_id);

CREATE INDEX idx_session_id 
    ON feedback_tab(session_id);

CREATE INDEX idx_chat_session 
    ON feedback_tab(chat_id, session_id);

CREATE INDEX idx_delete_time 
    ON feedback_tab(delete_time);

-- å¤åˆç´¢å¼•ï¼ˆæ”¯æŒå¤šæ¡ä»¶æŸ¥è¯¢ï¼‰
CREATE INDEX idx_chat_delete 
    ON feedback_tab(chat_id, delete_time);

CREATE INDEX idx_session_delete 
    ON feedback_tab(session_id, delete_time);
```

---

## åä¸€ã€ä½¿ç”¨åœºæ™¯ç¤ºä¾‹

### åœºæ™¯1: ç”¨æˆ·å¯¹ AI å›å¤è¿›è¡Œåé¦ˆ

```
æ—¶é—´çº¿:
14:30:00 - ç”¨æˆ·å¼ ä¸‰æé—®
14:30:05 - AI è¿”å›å›å¤
14:30:10 - ç”¨æˆ·ç‚¹å‡»"æœ‰å¸®åŠ©"æŒ‰é’®
         â†’ POST /feedback/new
         â†’ åé¦ˆåˆ›å»ºæˆåŠŸ (feedbackId: 1001)

14:35:00 - ç”¨æˆ·é‡æ–°é˜…è¯»å›å¤
14:35:05 - ç”¨æˆ·è§‰å¾—"è¿˜å·®ä¸€ç‚¹"
         â†’ PUT /feedback/update
         â†’ ä¿®æ”¹è¯„åˆ† 3â†’4
         â†’ ä¿®æ”¹è¯„è®º "æœ‰å¸®åŠ©" â†’ "åŸºæœ¬æœ‰å¸®åŠ©"

14:40:00 - ç®¡ç†å‘˜æŸ¥çœ‹åé¦ˆæ•°æ®ç”¨äºåˆ†æ
         â†’ GET /feedback/1001 (å†…éƒ¨ API)
         â†’ å¾—åˆ°æœ€æ–°åé¦ˆæ•°æ®
```

### åœºæ™¯2: åœ¨çº¿æ–‡æ¡£åé¦ˆç³»ç»Ÿ

```
åœºæ™¯: æ–‡æ¡£ä¸­æ¯ä¸ªæ®µè½éƒ½å¯è¯„åˆ†

ç”¨æˆ·å·¥ä½œæµ:
1. é˜…è¯»æ–‡æ¡£æ®µè½
2. ç‚¹å‡»"æœ‰ç”¨"æˆ–"æ— ç”¨"
3. å¯é€‰: å¡«å†™å…·ä½“åŸå› 
4. æäº¤åé¦ˆ

æ•°æ®æµ:
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ æ–‡æ¡£æ®µè½ (Chat ID)                   â”‚
â”‚ â”œâ”€ segmentId 12345                  â”‚
â”‚ â”œâ”€ content: "..."                   â”‚
â”‚ â””â”€ sessionId: 67890                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·åé¦ˆ                            â”‚
â”‚ â”œâ”€ ratting: 5 (å¥½)                  â”‚
â”‚ â”œâ”€ comment: "è§£é‡Šå¾ˆæ¸…æ¥š"            â”‚
â”‚ â””â”€ timestamp: 1694865234567         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â†“
åˆ†ææŠ¥å‘Š:
- æ®µè½æœ‰ç”¨åº¦: 92%
- å¸¸è§é—®é¢˜: "éœ€è¦æ·»åŠ ç¤ºä¾‹"
- ç”¨æˆ·å»ºè®®: æ”¶é›†å¹¶ä¼˜åŒ–æ–‡æ¡£
```

---

è¿™ä»½å·¥ä½œæµæ–‡æ¡£è¯¦ç»†è¯´æ˜äº† Feedback æ¨¡å—çš„å„ä¸ªä¸šåŠ¡æµç¨‹ã€æƒé™éªŒè¯ã€é”™è¯¯å¤„ç†ç­‰å…³é”®ç¯èŠ‚ï¼Œå¯ä½œä¸ºå¼€å‘å’Œæµ‹è¯•çš„å‚è€ƒã€‚
